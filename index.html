<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Google Login → People 3D</title>

  <!-- Google Login Library -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <!-- Import map so "three" and "three/addons/..." specifiers resolve to CDN modules -->
  <script type="importmap">
  {
    "imports": {
      "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
      "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
    }
  }
  </script>

  <link rel="stylesheet" href="css/main.css">
</head>

<body>
  <!-- LOGIN PAGE -->
  <div id="login-page">
    <div class="login-box">
      <h1>Welcome Back</h1>

      <!-- Google Sign-In Loader (configure client_id and callback below) -->
      <div 
        id="g_id_onload"
        data-client_id="906330928868-vkr46rngc5ju6mn66qv8qg47r2fg5jej.apps.googleusercontent.com"
        data-callback="handleCredentialResponse"
        data-auto_prompt="false">
      </div>

      <div class="g_id_signin"></div>
    </div>
  </div>

  <!-- TABLE / 3D PAGE (hidden until login) -->
  <div id="table-page">
    <div id="info">three.js css3d - people view</div>
    <div id="container"></div>

    <div id="menu">
      <button id="table">TABLE</button>
      <button id="sphere">SPHERE</button>
      <button id="helix">HELIX</button>
      <button id="grid">GRID</button>
    </div>
  </div>

  <!-- main module (creates window.showTablePage) -->
  <script type="module" src="js/main.js"></script>

  <script>
    // Called by Google GSI when login succeeds.
    // We DO NOT show user info — we only reveal the 3D view.
    function handleCredentialResponse(response) {
      // Parse the credential silently (not shown)
      try {
        const _ = (function parseJwt(token) {
          const base64Url = token.split('.')[1];
          const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
          const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
              return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
          }).join(''));
          return JSON.parse(jsonPayload);
        })(response.credential);
      } catch (e) {
        // ignore parse errors
      }

      // Show the 3D table page (main.js exposes this)
      if (window.showTablePage) {
        window.showTablePage();
      } else {
        // main.js might not be ready yet — try again shortly
        setTimeout(() => { if (window.showTablePage) window.showTablePage(); }, 250);
      }
    }
  </script>
</body>
</html>
